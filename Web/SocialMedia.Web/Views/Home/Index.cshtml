@using Microsoft.AspNetCore.Identity
@using SocialMedia.Areas.Identity.Data

@inject SignInManager<SocialMediaUser> SignInManager
@inject UserManager<SocialMediaUser> UserManager

@{
    ViewData["Title"] = "Home Page";
    var isAdmin = ViewData["IsAdmin"] != null && (bool)ViewData["IsAdmin"];
    var requests = (List<FriendRequest>)this.ViewData["FriendRequests"];

}

@model SocialMediaUser

@if (SignInManager.IsSignedIn(User))
{
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="~/SocialMedia.styles.css" asp-append-version="true" />
        <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

        <title>Document</title>
    </head>
    <body>

        @if (isAdmin)
        {
            <div class="admin-banner">
                Admin
            </div>
        }

        <div class="navbar">
            <input placeholder="Search..." type="text" name="text" class="input">
        </div>

        <div class="sidebar-right">
            <div class="friend-requests-heading">Friend requests</div>
            <div class="all-requests">
                @if (TempData["ErrorMessage"] != null)
                {
                    <div class="alert alert-danger">
                        @TempData["ErrorMessage"]
                    </div>
                }
            @foreach(var request in requests.Where(r => r.Status.Equals("Pending")))
            {
                    <div class="friend-requests" data-request-id="@request.Id">
                    <img src="@request.CreatedBy.ProfilePicture.CloudUrl" alt="Profile Picture" class="profile-pic">
                    <div class="request-info">
                        <span class="username-request">@request.CreatedBy.UserName</span>
                        <button class="btn-confirm" id="@request.Id">Confirm</button>
                        <button class="btn-delete" id="@request.Id">Delete</button>
                    </div>
                </div>
            }         
            </div>
        </div>

        <div class="main-content">
            <div class="post">
                <div class="post-header">
                    <img src="~/images/profile.svg" alt="Profile Picture" class="profile-pic">
                    <div class="post-info">
                        <span class="username">username</span>
                        <span class="location">Sofia, Bulgaria</span> <span class="location"></span>
                    </div>
                </div>
                <div class="carousel">
                    <div class="carousel-images">
                        <img src="~/images/d336a6c5-4918-4333-bf59-1a20d4a2d328.jpg" alt="Post Image 1" class="post-image">
                        <img src="~/images/🌊.jpg" alt="Post Image 2" class="post-image">
                        <img src="~/images/d336a6c5-4918-4333-bf59-1a20d4a2d328.jpg" alt="Post Image 3" class="post-image">
                        <img src="~/images/🌊.jpg" alt="Post Image 4" class="post-image">
                    </div>
                    <button class="carousel-arrow left-arrow">&lt;</button>
                    <button class="carousel-arrow right-arrow">&gt;</button>
                    <div class="carousel-indicators">
                        <span class="dot active"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                    <div class="image-counter">1 / 4</div>
                </div>

                <div class="post-actions">
                    <div class="post-likes">
                        <div class="likes-count" id="image-container">
                            <img id="toggleImage" src="~/images/heart.svg" alt="SVG Image" class="reaction-heart" data-liked="false">

                            <script>
                                document.addEventListener("DOMContentLoaded", function () {
                                    const images = document.querySelectorAll(".reaction-heart");
                                    const img1 = "/images/heart.svg";
                                    const img2 = "/images/heart.png";

                                    images.forEach(image => {
                                        image.addEventListener("click", function() {
                                            let liked = this.getAttribute("data-liked") === "true";
                                            let counter = this.parentElement.querySelector(".count-likes-number");

                                            if (liked) {
                                                this.src = img1;
                                                counter.textContent = Math.max(0, parseInt(counter.textContent) - 1);
                                                this.setAttribute("data-liked", "false");
                                            } else {
                                                this.src = img2;
                                                counter.textContent = parseInt(counter.textContent) + 1;
                                                this.setAttribute("data-liked", "true");
                                            }
                                        });
                                    });
                                });
                            </script>

                            <div class="count-likes-number">0</div>
                            <img src="~/images/comment.svg" class="comment-image">
                            <div class="count-comment-number">0</div>
                        </div>
                    </div>
                </div>

                <div class="post-caption">
                    <span class="username">username</span>
                    <p class="post-description">
                        Lorem ipsum dolor sit, amet consectetur adipisicing elit. Rem, earum quibusdam cumque quod sit nisi ab
                        <span class="post-description-hidden-text">
                            exercitationem voluptas consequuntur enim, unde tempore? Dolor dignissimos maxime optio minus tempore
                            quaerat molestias.
                        </span>
                        <button class="toggle-btn">Read more</button>
                    </p>
                </div>
            </div>

            <div class="post">
                <div class="post-header">
                    <img src="~/images/profile.svg" alt="Profile Picture" class="profile-pic">
                    <div class="post-info">
                        <span class="username">username</span>
                        <span class="location">Sofia, Bulgaria</span> <span class="location"></span>
                    </div>
                </div>

                <div class="carousel">
                    <div class="carousel-images">
                        <img src="~/images/images.jpeg" alt="Post Image 1" class="post-image">
                        <img src="24-12-01_-_НПМГ_-_12А_-_138 (1).jpg" alt="Post Image 2" class="post-image">
                        <img src="24-12-01_-_НПМГ_-_12А_-_139 (1).jpg" alt="Post Image 3" class="post-image">
                    </div>
                    <button class="carousel-arrow left-arrow">&lt;</button>
                    <button class="carousel-arrow right-arrow">&gt;</button>
                    <div class="carousel-indicators">
                        <span class="dot active"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </div>
                    <div class="image-counter">1 / 3</div>
                </div>
                <div class="post-actions">
                    <div class="post-likes">
                        <div class="likes-count">
                            <img src="~/images/heart.svg" class="reaction-heart">
                            <div class="count-likes-number">0</div>
                            <img src="~/images/comment.svg" class="comment-image">
                            <div class="count-comment-number">0</div>
                        </div>
                    </div>
                </div>
                <div class="post-caption">
                    <span class="username">username</span>
                    <p class="post-description">
                        Lorem ipsum dolor sit, amet consectetur adipisicing elit. Rem, earum quibusdam cumque quod sit nisi ab
                        <span class="post-description-hidden-text">
                            exercitationem voluptas consequuntur enim, unde tempore? Dolor dignissimos maxime optio minus tempore
                            quaerat molestias.
                        </span>
                        <button class="toggle-btn">Read more</button>
					</p>
                </div>
            </div>
		</div>
		
    </body>
        
 

    </html>
    @section Scripts {
    <script src="~/js/imagesFunctions.js"></script>
    }
}
